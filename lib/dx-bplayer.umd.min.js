(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["dx-bplayer"]=t():e["dx-bplayer"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="fb15")}({"048c":function(e,t,i){},"1ce2":function(e,t,i){},"1db2":function(e,t,i){},"2b81":function(e,t,i){},"3e2a":function(e,t,i){"use strict";var s=i("048c"),n=i.n(s);n.a},5313:function(e,t,i){},"725b":function(e,t,i){},"7deb":function(e,t,i){"use strict";var s=i("5313"),n=i.n(s);n.a},9224:function(e){e.exports=JSON.parse('{"name":"dx-bplayer","version":"0.2.0","description":"This is a simple HTML5 video player based on Vue.","main":"lib/dx-bplayer.umd.min.js","private":false,"scripts":{"serve":"vue-cli-service serve","build":"vue-cli-service build","lib":"vue-cli-service build --target lib --name dx-bplayer --dest lib packages/index.js"},"repository":{"type":"git","url":"https://github.com/boboyaohuo/Dx-BPlayer.git"},"keywords":["vue","Dx-BPlayer","BPlayer","player","video","vue-video"],"author":"wujianbo","license":"MIT","bugs":{"url":"https://github.com/boboyaohuo/Dx-BPlayer/issues"},"homepage":"https://github.com/boboyaohuo/Dx-BPlayer#readme","devDependencies":{"vue":"^2.6.11","@vue/cli-plugin-babel":"^3.9.0","@vue/cli-service":"^3.9.0","stylus":"^0.54.5","stylus-loader":"^3.0.2","vue-template-compiler":"^2.6.10"}}')},"996f":function(e,t,i){"use strict";var s=i("725b"),n=i.n(s);n.a},b37b:function(e,t,i){"use strict";var s=i("deb0"),n=i.n(s);n.a},dd03:function(e,t,i){"use strict";var s=i("2b81"),n=i.n(s);n.a},deb0:function(e,t,i){},e673:function(e,t,i){"use strict";var s=i("1db2"),n=i.n(s);n.a},f20b:function(e,t,i){"use strict";var s=i("1ce2"),n=i.n(s);n.a},f6fd:function(e,t){(function(e){var t="currentScript",i=e.getElementsByTagName("script");t in e||Object.defineProperty(e,t,{get:function(){try{throw new Error}catch(s){var e,t=(/.*at [^\(]*\((.*):.+:.+\)$/gi.exec(s.stack)||[!1])[1];for(e in i)if(i[e].src==t||"interactive"==i[e].readyState)return i[e];return null}}})})(document)},fb15:function(e,t,i){"use strict";var s;(i.r(t),"undefined"!==typeof window)&&(i("f6fd"),(s=window.document.currentScript)&&(s=s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/))&&(i.p=s[1]));var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"bplayer_container",staticClass:"dx-bplayer",class:[e.isFixed?"fixed":"",e.isFullscreen?"fullscreen":""],on:{click:function(t){return t.stopPropagation(),e.clearModeTogger(t)}}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isPlaying&&e.isStart,expression:"!isPlaying && isStart"}],staticClass:"bplayer_poster",style:{backgroundImage:"url("+e.options.poster+")"}}),[i("video",{ref:"bplayer_video",staticClass:"bplayer-video",attrs:{id:"bplayer-video","webkit-playsinline":"",playsinline:"","x5-video-player-fullscreen":"false","x-webkit-airplay":"allow","x5-video-player-type":"h5","x5-video-orientation":"landscape",loop:e.options.loop,preload:e.options.preload},domProps:{muted:e.options.muted}},[i("source",{attrs:{src:e.options.url,type:"video/"+e.getUrlType(e.options.url)}}),e._v("\n      Your browser does not support the video element.\n    ")]),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isFixed,expression:"!isFixed"}]},[i("transition",{attrs:{name:"fade-center"}},[e.isStart||e.isWaiting?i("StartBtn",{attrs:{isStart:e.isStart,isWaiting:e.isWaiting},on:{play:e.handlePlay}}):e._e()],1),i("transition",{attrs:{name:"fade-bottom"}},[i("BaseControls",{directives:[{name:"show",rawName:"v-show",value:!e.isClearMode&&!e.isStart,expression:"!isClearMode && !isStart"}],attrs:{isPlaying:e.isPlaying},on:{pause:e.handlePause,play:e.handlePlay,wait:e.handleWait,canplay:e.handleCanplay,fullscreen:e.handleFullscreen}})],1)],1),i("transition",{attrs:{name:"fade-center"}},[e.isClearMode&&!e.isStart||e.isFixed?i("div",{staticClass:"bplayer_slider"},[i("div",{staticClass:"bplayer_slider-cur",style:{width:e.offsetLeft}})]):e._e()]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isFixed,expression:"isFixed"}]},[i("div",{staticClass:"bplayer-close",on:{click:e.handleClose}},[e._v("×")])])]],2)},r=[],l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"bplayer-base-controls"},[i("PlayBtn"),i("Volume"),i("Progress"),i("Fullscreen")],1)},a=[],o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"bplayer_play",class:e.isPlaying?"play":"pause",on:{click:function(t){return t.stopPropagation(),e.handlePlay(t)}}})},c=[],d={name:"PlayBtn",inject:["$player"],computed:{isPlaying(){return this.$player.isPlaying}},methods:{handlePlay(){this.isPlaying?this.$player.handlePause():this.$player.handlePlay()}}},u=d;i("3e2a");function h(e,t,i,s,n,r,l,a){var o,c="function"===typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=i,c._compiled=!0),s&&(c.functional=!0),r&&(c._scopeId="data-v-"+r),l?(o=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(l)},c._ssrRegister=o):n&&(o=a?function(){n.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:n),o)if(c.functional){c._injectStyles=o;var d=c.render;c.render=function(e,t){return o.call(t),d(e,t)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,o):[o]}return{exports:e,options:c}}var p=h(u,o,c,!1,null,"79e44aac",null),f=p.exports,m=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"bplayer_vol",class:e.isMuted?"muted":"noMuted",on:{click:function(t){return t.stopPropagation(),e.handleClick(t)}}})},y=[],v={name:"Volume",inject:["$player"],computed:{isMuted(){return this.$player.options.muted}},methods:{handleClick(){this.$player.handleMute()}}},g=v,b=(i("7deb"),h(g,m,y,!1,null,"93531b68",null)),$=b.exports,x=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"bplayer_progress",on:{click:function(e){e.stopPropagation()}}},[i("span",{staticClass:"bplayer_time-current"},[e._v(e._s(e.textCurrentTime))]),i("div",{ref:"bplayer_sliderRef",staticClass:"bplayer_slider",class:e.sliderInfo.isMove?"move":"",on:{click:function(t){return t.stopPropagation(),e.clickSlider(t)}}},[i("div",{staticClass:"bplayer_slider-cur",style:{width:e.offsetLeft}}),i("i",{ref:"bplayer_sliderBtnRef",staticClass:"bplayer_slider-btn",class:e.sliderInfo.isMove?"move":"",style:{left:e.offsetLeft},on:{click:function(e){e.stopPropagation()}}})]),i("span",{staticClass:"bplayer_time-amount"},[e._v(e._s(e.textTotalTime))])])},T=[];const C=/mobile/i.test(window.navigator.userAgent);var _={name:"Progress",inject:["$player"],data(){return{textTotalTime:"00:00",textCurrentTime:"00:00",offsetLeft:0,sliderInfo:{isMove:!1,startX:0,oldTime:0,oldOffsetLeft:0}}},computed:{sliderRef(){return this.$refs.bplayer_sliderRef}},watch:{offsetLeft(e,t){this.$player.offsetLeft=e}},methods:{secondToTime(e=0){e=e>0?e:0;const t=e=>e<10?"0"+e:e,i=~~(e/3600),s=~~(e%3600/60),n=~~(e%60);return(i>0?[i,s,n]:[s,n]).map(t).join(":")},updateSlider(e){e>=0&&e<=100&&(this.offsetLeft=e+"%")},updateTextTime(e){this.textCurrentTime=this.secondToTime(e)},updateVideoTime(e){e&&(this.$player.$video.currentTime=e)},clickSlider(e){if(this.$player.isStart)return;const t=this.sliderRef.offsetWidth,i=e.clientX-e.target.getBoundingClientRect().left;this.offsetLeft=~~(i/t*100)+"%",this.updateVideoState()},updateVideoState(){const e=~~(this.$player.$video.duration*(parseFloat(this.offsetLeft)/100));this.updateVideoTime(e),this.updateTextTime(e),this.$player.setClearModeTimer()},initVideoEvents(){const e=["canplay","play","waiting","timeupdate","durationchange","loadeddata"];e.forEach(e=>{this.$player.$video.addEventListener(e,this["handle"+e.toLowerCase().replace(/^./,e=>e.toUpperCase())],!1)})},initSliderBtnEvents(){const e={DragStart:C?"touchstart":"mousedown",DragMove:C?"touchmove":"mousemove",DragEnd:C?"touchend":"mouseup"};Object.keys(e).forEach(t=>{const i=this.$refs.bplayer_sliderBtnRef;i.addEventListener(e[t],this["handle"+t],!1)})},handleLoadeddata(){const e=this.$player.$video.duration;this.textTotalTime=this.secondToTime(e)},handleCanplay(){this.$player.handleCanplay()},handleDurationchange(){const e=this.$player.$video.duration;this.textTotalTime=this.secondToTime(e)},handleTimeupdate(){if(this.sliderInfo.isMove)return;const e=this.$player.$video.currentTime,t=e/this.$player.$video.duration*100;this.updateTextTime(e),this.updateSlider(t)},handlePause(){const e=this.$player.$video.duration,t=this.$player.$video.currentTime;t===e&&(this.$player.isPlaying=!1),this.$player.handlePause()},handlePlay(){this.$player.handlePlay()},handleWaiting(){this.$player.handleWait()},computeMoveInfo(e){const t=this.sliderRef.offsetWidth;let i=e-this.sliderInfo.startX;Math.abs(i)>=t&&(i=i>0?t:-t);const s=i/t*100,n=this.$player.$video.duration*(s/100);return{ratio:s,second:n}},handleDragStart(e){e.preventDefault(),e.stopPropagation(),this.$player.isStart||(this.sliderInfo.startX=e.clientX||e.changedTouches[0].clientX,this.sliderInfo.isMove=!0,this.$player.isMove=!0,this.sliderInfo.oldTime=this.$player.$video.currentTime,this.sliderInfo.oldOffsetLeft=parseFloat(this.offsetLeft))},handleDragMove(e){e.preventDefault(),e.stopPropagation();const t=e.clientX||e.changedTouches[0].clientX;if(this.sliderInfo.isMove){const{ratio:e,second:i}=this.computeMoveInfo(t);this.updateSlider(e+this.sliderInfo.oldOffsetLeft),this.updateTextTime(i+this.sliderInfo.oldTime)}},handleDragEnd(e){const t=e.clientX||e.changedTouches[0].clientX;if(this.sliderInfo.isMove){const{ratio:e,second:i}=this.computeMoveInfo(t);this.updateVideoTime(i+this.sliderInfo.oldTime),this.sliderInfo.isMove=!1,this.$player.isMove=!1,this.$player.setClearModeTimer()}}},mounted(){this.$nextTick(()=>{this.initVideoEvents(),this.initSliderBtnEvents()})}},S=_,F=(i("996f"),h(S,x,T,!1,null,"01e8103e",null)),P=F.exports,w=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"bplayer_fullscreen",class:e.isFullscreen?"full":"noFull",on:{click:function(t){return t.stopPropagation(),e.handleClickToggle(t)}}})},M=[],E={name:"Fullscreen",inject:["$player"],data(){return{isFullscreen:!1}},methods:{handleClickToggle(){this.isFullscreen?this.resetFullScreen():this.reqFullScreen(this.$player.$container)},setFullscreenState(){const e=document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement;e&&e!==this.$player.$container||(this.isFullscreen=!!e,this.$player.handleFullscreen(this.isFullscreen))},reqFullScreen(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.webkitEnterFullscreen?e.webkitEnterFullscreen():this.$player.$video.webkitEnterFullscreen?this.$player.$video.webkitEnterFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():console.log("进入全屏失败")},resetFullScreen(){document.cancelFullScreen?document.cancelFullScreen():document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.msCancelFullScreen?document.msCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},docfullscreenchange(){this.setFullscreenState()},fullscreenchange(){this.setFullscreenState()},unbindChangeEvent(){/Firefox/.test(navigator.userAgent)?(document.removeEventListener("mozfullscreenchange",this.docfullscreenchange),document.removeEventListener("fullscreenchange",this.docfullscreenchange)):(this.$player.$container.removeEventListener("fullscreenchange",this.fullscreenchange),this.$player.$container.removeEventListener("webkitfullscreenchange",this.fullscreenchange),document.removeEventListener("msfullscreenchange",this.docfullscreenchange),document.removeEventListener("MSFullscreenChange",this.docfullscreenchange),document.removeEventListener("x5videoenterfullscreen",this.docfullscreenchange))},bindChangeEvent(){/Firefox/.test(navigator.userAgent)?(document.addEventListener("mozfullscreenchange",this.docfullscreenchange),document.addEventListener("fullscreenchange",this.docfullscreenchange)):(this.$player.$container.addEventListener("fullscreenchange",this.fullscreenchange),this.$player.$container.addEventListener("webkitfullscreenchange",this.fullscreenchange),document.addEventListener("msfullscreenchange",this.docfullscreenchange),document.addEventListener("MSFullscreenChange",this.docfullscreenchange),document.addEventListener("x5videoenterfullscreen",this.docfullscreenchange))}},mounted(){this.$nextTick(()=>{this.bindChangeEvent()})},beforeDestroy(){this.$player.$container&&this.unbindChangeEvent()}},k=E,L=(i("e673"),h(k,w,M,!1,null,"c3fe80c4",null)),j=L.exports,B={name:"BaseControls",components:{PlayBtn:f,Volume:$,Progress:P,Fullscreen:j}},I=B,V=(i("b37b"),h(I,l,a,!1,null,"58a459b1",null)),O=V.exports,D=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e.isStart?i("div",{staticClass:"bplayer_start",on:{click:function(t){return t.stopPropagation(),e.handleStart(t)}}}):e._e(),e.isWaiting&&!e.isStart?i("div",{staticClass:"bplayer_waiting"}):e._e()])},R=[],W={inject:["$player"],props:{isStart:{default:!0,type:Boolean},isWaiting:{default:!0,type:Boolean}},methods:{handleStart(){this.$player.handlePlay()}}},X=W,q=(i("f20b"),h(X,D,R,!1,null,"3c7b52bc",null)),N=q.exports;const z=i("9224").version;var A={name:"DxBPlayer",provide(){return{$player:this}},components:{BaseControls:O,StartBtn:N},props:{playerOptions:{type:Object,default:function(){return{}}},mutex:{type:Boolean,default:!1}},data(){return{baseVideo:{url:"",poster:"",muted:!1,loop:!1,preload:"auto",volume:1,autoplay:!1,scrollFixed:!1},$video:null,$container:null,clearModeTimer:null,isStart:!0,isWaiting:!0,isPlaying:!1,isMove:!1,isClearMode:!1,isFixed:!1,isFullscreen:!1,offsetLeft:0}},watch:{isPlaying(e,t){this.play(),e?this.$emit("play"):this.$emit("pause")},isFixed(e,t){this.$emit("fixed",e)},isClearMode(e,t){this.$emit("clearMode",e)}},computed:{options(){return Object.assign({},this.baseVideo,this.playerOptions)}},methods:{getUrlType(e){let t=e.split("?")[0]+"?v=1";return t.match(/[^\.]+(?=\?)/)||"mp4"},init(){this.$video=this.$refs.bplayer_video,this.$container=this.$refs.bplayer_container,this.$video.load(),this.initPlayer(),this.$emit("ready")},initPlayer(){this.$video.volume=this.options.volume,setTimeout(()=>{this.isPlaying=this.options.autoplay,this.$video.muted=!1},200)},clearModeTogger(){!this.isStart&&this.isPlaying&&(this.isClearMode=!this.isClearMode,this.isClearMode||this.setClearModeTimer())},setClearModeTimer(){this.clearModeTimer&&clearTimeout(this.clearModeTimer),this.clearModeTimer=setTimeout(()=>{!this.isMove&&this.isPlaying&&(this.isClearMode=!0,this.$emit("clearMode"))},4e3)},pauseAllVideo(){if(this.mutex){const e=document.querySelectorAll("video:not(.bplayer-video)");e.forEach(e=>{e.pause&&e.pause()})}},play(){this.isPlaying?(this.pauseAllVideo(),this.$video.play().then(()=>{this.setClearModeTimer()}).catch(e=>{})):this.$video.pause()},handleCanplay(){this.isWaiting=!1,this.$emit("canplay")},handleWait(){this.isWaiting=!0,this.$emit("wait")},handlePause(){this.isPlaying=!1,this.isClearMode=!1},handlePlay(){this.isPlaying=!0,this.isStart=!1},handleFullscreen(e){this.setClearModeTimer(),this.isFullscreen=e,this.$emit("fullscreen",e)},handleMute(){this.setClearModeTimer(),this.baseVideo.muted=!this.baseVideo.muted},handleClose(){this.isFixed=!1,this.isPlaying=!1,this.isClearMode=!1,this.$emit("close")},handleScroll(){this.scrollTop=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,this.markTop=this.$refs.bplayer_video.offsetTop+this.$refs.bplayer_video.offsetHeight,this.scrollTop>this.markTop&&this.isPlaying||this.scrollTop>this.markTop&&this.isFixed?this.isFixed=!0:this.isFixed=!1}},created(){this.$emit("created"),this.$nextTick(()=>{this.options.scrollFixed&&window.addEventListener("scroll",this.handleScroll,!0),this.init()})},mounted(){this.$emit("mounted"),console.log("\n %c dx-bplayer v"+z+" %c https://github.com/boboyaohuo/dx-bplayer \n","color: #ff461a; background: #f5f5f5; padding:6px 0;","background: #f5f5f5; padding:6px 0;")},beforeDestroy(){this.$emit("beforeDestroy")},destroyed(){window.removeEventListener("scroll",this.handleScroll,!0),this.$emit("destroyed")}},U=A,H=(i("dd03"),h(U,n,r,!1,null,"6277c324",null)),Y=H.exports;Y.install=function(e){e.component(Y.name,Y)};var J=Y;const G=i("9224").version,K=[J],Q=function(e){Q.installed||K.map(t=>e.component(t.name,t))};"undefined"!==typeof window&&window.Vue&&Q(window.Vue);var Z={install:Q,version:G,DxBPlayer:J};t["default"]=Z}})}));
//# sourceMappingURL=dx-bplayer.umd.min.js.map